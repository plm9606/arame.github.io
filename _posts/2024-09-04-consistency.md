---
title: 일관성(consistency)
categories: [cs]
tags: [cs, consistency, eventual_consistency]
author: aram
toc: true
comment: true
---
## Consistency란 무엇?
분산 시스템과 분산 데이터베이스 맥락에서 모든 레플리카 혹은 노드가 특정 규칙이나 제약사항을 지키면서 같은 데이터view를 보여줄 수 있도록 보장하는 속성을 말한다. 
이는 데이터가 여러 위치나 노드에 분산되어 있더라도 시스템 전체에서 데이터가 일관성 있고 올바른 상태로 유지되도록 보장.

> 시스템의 일관성을 유지하는 것은 왜 중요할까?

Read Consistency
읽기 요청이 어떤 노드로 보내지던지 상관 없이 어떤 데이터의 읽기 연산도 가장 최근에 write된 값 또는 특정 consistency guarantees를 만족하는 값을 리턴할 것이다. 

Write Consistency
쓰기 명령이 수행되면 데이터는 시스템의 모든 관련된 노드로 전파되어 해당 명령이 성공한 것으로 간주되기 전에 모든 복제본이 최신 값으로 업데이트된다.

## 왜 consistency가 필요한가?
일관성은 시스템과 상호작용하는 모든 유저, 어플리케이션, 서비스가 어떤 노드에 접속하던지 통합된 그리고 최신의 데이터를 보도록 보장한다. 

1. 데이터 무결성
일관성은 데이터의 정확성과 신뢰성을 보장해준다. 데이터가 일관성이 없으면 잘못된 데이터가 저장되거나 검색될 수 있어서, 업무 프로세스나 분석 결과에 악영향을 미칠 수 있다.

2. 사용자 신뢰
사용자들이 시스템을 신뢰하게 만드는 것이 중요하다. 일관되지 않은 데이터는 사용자가 시스템의 데이터를 믿지 못하게 해서 사용자 경험에 부정적인 영향을 미칠 수 있다.

3. 동시성 제어
여러 사용자가 동시에 데이터에 접근할 때, 일관성은 데이터가 올바르게 관리되도록 돕는다. 예를 들어, 은행 트랜잭션 시스템에서 일관성은 두 사용자가 같은 계좌에 대해 작업할 때 계좌 잔액을 정확하게 유지하게 해준다.

4. 트랜잭션 관리
일관성은 ACID(Atomicity, Consistency, Isolation, Durability) 속성에서 매우 중요한 역할을 한다. 일관성은 모든 트랜잭션이 시스템의 비즈니스 규칙을 충족하는지 확인한다. 트랜잭션이 완료된 후에도 시스템 상태가 일관된 상태로 유지된다.

5. 데이터 복구
장애나 오류가 발생했을 때, 일관성 있는 시스템은 데이터를 올바르게 복구할 수 있다. 일관성이 없으면 복구 과정에서 데이터 손실이나 왜곡이 발생할 수 있다.

6. 데이터 복제
분산 시스템에서는 데이터 복제를 통해 성능과 가용성을 높인다. 일관성은 모든 데이터 복제본이 동일하고 최신 정보를 갖고 있도록 보장한다.


## Strong Consistency
String Consistency는 시스템의 모든 노드가 동일한 시간에 동일한 데이터를 보고 있음을 보장한다. 다른 말로 쓰기 연산이 수행되면 그다음에 수행되는 모든 읽기연산은 가장 최근에 write된 값을 리턴할 것이다. 이는 연산이 선형적으로 수행되는 것을 보장하고, 마치 하나의 시스템인 것 처럼 작동한다. 


## Eventual Consistency
시간이 지남에 따라 시스템은 일관성을 향해 수렴되지만 일시적인 기간 동안 다른 데이터 센터에 액세스하는 사용자는 다른 버전의 데이터를 관찰할 수 있음. 이것이 최종 일관성의 특징적인 동작. 시스템은 업데이트가 결국 전파되고 모든 노드가 일관된 상태에 도달하도록 보장하지만 특정 순간에 노드 간에 일시적인 불일치가 있을 수 있음.

![alt text](/assets/img/consistency_image.png)

## 트레이드오프
1. 데이터 정확성
   - strong consistency: 모든 노드가 동시에 동일한 데이터를 보여줄 수 있음을 보장.
   - Eventual Consistency: 일시적으로 노드들의 일관성이 깨질 수 있다. 

2. 퍼포먼스
   - Strong Consistency: Strong Consistency를 달성하려면 노드 간의 조정 및 통신이 늘어나 읽기 및 쓰기 작업의 대기 시간이 길어지는 경우가 많음. 속도가 느려질 수 있음.
   - Eventual Consistency: 쓰기 전파의 비동기성과 조정 오버헤드 감소를 통해 lower latency, higher throughput. 시스템을 더욱 쉽게 확장하고 더 많은 수의 동시 요청을 처리할 수 있음.

3. 가용성: 
Strong Consistency: 네트워크 파티션 또는 노드 오류 중에 강력한 일관성을 유지하면 읽기 또는 쓰기 작업에 필요한 복제본 수에 도달할 수 없는 경우 가용성이 저하될 수 있음. 이러한 시나리오에서는 시스템이 가용성보다 일관성을 우선시한다.
Eventual Consistency: 네트워크 파티션 및 노드 장애 시 가용성을 강조. 복제본은 독립적으로 작동할 수 있으므로 일부 노드에 연결할 수 없는 경우에도 시스템은 읽기 및 쓰기 작업에 계속 사용할 수 있다.

5. 사용 사례: 
Strong Consistency: 금융 시스템, 전자 상거래 플랫폼 및 중요한 비즈니스 애플리케이션과 같이 데이터 무결성과 일관성이 중요한 시나리오
Eventual Consistency: 소셜 미디어 플랫폼, 콘텐츠 배포 네트워크, 협업 시스템과 같이 실시간 일관성이 중요하지 않고 시스템 가용성과 확장성이 더 중요한 애플리케이션


### ref
https://medium.com/@abhirup.acharya009/strong-consistency-vs-eventual-consistency-19ce6f87c112
