---
title: 가비지 컬렉터 종류
categories: [jvm]
tags: [jvm, jvm밑바닥까지파해치기, gc]
author: aram
toc: true
comment: true
---
# 가비지 컬렉터 종류
가비지 컬렉터를 측정하는 가장 중요한 지표는 3가지 이다.
- 처리량
- 지연 시간
- 메모리 사용량


## G1 컬렉터
- 부분 회수
- 리전을 회수 단위로 함


G1의 등장 전 까지는 모든 컬렉터의 회수 범위는 신세대 전체, 구세대 전체, 또는 자바 힙 전체였다. 
![alt text](/assets/img/gc-image.png)
G1은 크기와 수가 고정된 세개 단위 영역 구분에서 벗어나 연속된 자바 힙을 동일 크기의 여러 `리전` 으로 나눈다. 각 리전은 필요에 따라 신세대의 에덴이나 생존자 공간이 될 수도, 구세대용 공간으로 쓰일 수도 있다. 
G1은 여전히 신세대/구세대 개념을 사용하지만 세대가 고정되어있지는 않다. 리전별 역할을 동적으로 바꿀 수 있고, 같은 역할의 리전이 연이어 배치 될 필요도 없다. 

어느 세대에 속하느냐가 아니라 어느 영역에 쓰레기가 가장 많으냐 에 집중.
G1이후에는 자바 힙 전체를 한번에 청소하기보다 애플리케이션의 메모리 할당 속도에 맞춰 회수하는 방향으로 변화함.

### 수행 과정
1. 최초 표시
    - stop the world
        - 소요시간이 매우 짧고, 마이너 GC가 실행되는 시간을 틈타 동시에 끝나므로 전체 플로우로보면 멈추는 것 처럼 느껴지지 않음
    - GC루트가 직접 참조하는 객체들을 표시하고 TAMS 포인터의 값을 수정한다. 
2. 동시 표시
    - GC루트로부터 시작하여 객체들의 도달 가능성을 분석하고, 전체 힙의 객체 그래프를 재귀적으로 스캔하며 회수할 객체를 찾는다
    - 시간이 좀 걸리는 작업이지만 사용자 스레드와 동시 수행됨
3. 재표시
    - stop the world
    - 시작 단계 스냅샷 이후 변경된 소수의 객체만 처리하면 되므로 매우 빠르게 끝남
4. 복사 및 청소
    - stop the world
        - 생존 객체를 이동시켜야 하므로 스레드가 잠시 멈춘다
        - 다수의 GC스레드가 병렬로 처리
    - 회수 계획을 세우고 회수할 리전들을 적절히 선별하고 선별된 리전들에서 살아남은 객체들을 빈 리전에 이전시킨다
    ![alt text](/assets/img/gc-image-1.png)

![alt text](/assets/img/gc-image-2.png)



## 셰넌도어
오라클에서 개발하지 않은 첫 가비지 컬렉터. 핍박받음.. 오라클 JDK에는 없고 다른 회사의 OpenJDK에만 있다

동시 모으기 지원
사용자 스레드와 동시에 수행가능 (G1은 안댐)

세대 단위 컬렉션 사용하지 않음

기억 집합 대신 연결 행렬로 리전 간 참조 관계를 기록


